nrow(buys)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(code))
View(buys)
buys <- data.frame(buys)
colnames(buys) <- code
View(buys)
trade_dates <- matrix(NA, nrow = 252 * 12, ncol = 1)
buys <- cbind(trade_dates, buys)
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
buys <- cbind(trade_dates, buys)
colnames(trade_dates) <- "Date"
buys <- matrix(NA, nrow = 252 * 11, ncol = length(code))
buys <- data.frame(buys)
buys <- cbind(trade_dates, buys)
View(buys)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(code))
buys <- data.frame(buys)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(code))
buys <- data.frame(buys)
colnames(buys) <- code
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
buys[r, code] <- t(buys_only[, "CountOfTrades", drop = F])
trade_dates[r, 1] <- dates
r <- r + 1
}
}
buys[r, code] <- t(buys_only[, "CountOfTrades", drop = F])
temp <- t(buys_only[, 1, drop = F])
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys <- matrix(NA, nrow = 252 * 11, ncol = length(code))
buys <- data.frame(buys)
colnames(buys) <- code
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
trade_dates[r, 1] <- dates
r <- r + 1
}
}
df=code_list[[1]]
df <- bind_rows(code_list)
View(code_list)
yrs <- 2008:2018
yrs <- as.character(2008:2018)
names(code_list) <- yrs
df <- bind_rows(code_list)
dfs <- ""
for (df in code_list) {
dfs <- c(dfs, df)
}
tickers <- unique(dfs)
View(tickers)
pkgs <- c("data.table", "forecast", "tseries", "kableExtra", "reshape2", "InfoTrad", "mFilter", "tidyverse", "qrmtools", "tidyquant",
"stargazer", "qrmtools", "gridExtra", "tbl2xts", "highfrequency", "pinbasic")
# install.packages(pkgs) #install
pkgs <- c(pkgs, "timeDate", "readxl")
sapply(pkgs, library, character.only = T)
pin_names <- file.info(list.files
(path = getwd(),
pattern = "*.csv",
full.names = T))
pin_files <- rownames(pin_names)
buy_list <- vector("list", length = nrow(pin_names))
i <- 1
code_list <- vector("list", length = length(pin_files))
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
if (dates==LBD[1]) {
code <- t(buys_only[, 1, drop = F])
code <- code[1, ]
} else {
temp <- t(buys_only[, 1, drop = F])
temp <- temp[1,]
if (length(temp) > length(code)) {
code <- temp
print(length(code))
}
}
}
code_list[[r]] <- code
r <- r + 1
}
yrs <- as.character(2008:2018)
names(code_list) <- yrs
df <- bind_rows(code_list)
dfs <- ""
for (df in code_list) {
dfs <- c(dfs, df)
}
tickers <- unique(dfs)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
trade_dates[r, 1] <- dates
r <- r + 1
}
}
View(buys)
length(temp[1])
if(length(temp[1])){
temp[1] <- colnames(buys)[1]
}
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1])){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
trade_dates[r, 1] <- dates
buys[r, 1] <- dates
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1])){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
}
View(buys)
ncol(buuys)
ncol(buys)
tickers <- unique(dfs)
length(tickers)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1])){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
print(ncol(buys))
}
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
f
pf
pf=pin_data[1]
pin_data <- read.csv(pf)
pf=pin_files[1]
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
dates=LBD[1]
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1])){
temp[1] <- colnames(buys)[2]
}
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1]==1)){
temp[1] <- colnames(buys)[2]
}
temp <- t(buys_only[, 1, drop = F])
if(length(temp[1])==1){
temp[1] <- colnames(buys)[2]
}
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==1){
temp[1] <- colnames(buys)[2]
}
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==1){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
print(ncol(buys))
}
if(nchar(temp[1])==1)
j
nchar(temp[1])
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==0){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
print(ncol(buys))
}
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
pf=pin_files[1]
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
temp <- t(buys_only[, 1, drop = F])
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
dates=LBD[1]
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==0){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
test <- t(buys_only[, "CountOfTrades", drop = F])
lmc <- buys[1,temp]
colnames(buys)
lmc <- buys[1,temp, drop = F]
lmcc <- temp %in% tickers
View(lmcc)
code_list <- vector("list", length = 11*252)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
if (dates==LBD[1]) {
code <- t(buys_only[, 1, drop = F])
code <- code[1, ]
code_list[[r]] <- code
r <- r + 1
}
}
}
dfs <- ""
for (df in code_list) {
dfs <- c(dfs, df)
}
tickers <- unique(dfs)
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==0){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
print(ncol(buys))
}
View(code_list)
code_list[[12]]
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
if (dates==LBD[1]) {
code <- t(buys_only[, 1, drop = F])
code <- code[1, ]
code_list[[r]] <- code
r <- r + 1
}
}
}
code_list <- vector("list", length = 11*252)
r <- 1
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
code <- t(buys_only[, 1, drop = F])
code <- code[1, ]
code_list[[r]] <- code
r <- r + 1
}
}
View(code_list)
df = code_list[[2772]]
dfs <- c(dfs, df)
dfs <- ""
dfs <- c(dfs, df)
for (df in code_list) {
dfs <- c(dfs, df)
}
length(df)
length(dfs)
tickers <- unique(dfs)
View(tickers)
View(tickers)
which(tickers=="BH")
which(tickers=="BHP")
buys <- matrix(NA, nrow = 252 * 11, ncol = length(tickers))
buys <- data.frame(buys)
colnames(buys) <- tickers
trade_dates <- matrix(NA, nrow = 252 * 11, ncol = 1)
colnames(trade_dates) <- "Date"
buys <- cbind(trade_dates, buys)
r <- 1
for (pf in pin_files) {
pin_data <- read.csv(pf)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
LBD <- as.character(LBD)
for (dates in LBD) {
buys_only <- pin_data %>%
filter(BuySellIndicator == "B") %>%
filter(LogicalBusinessDay == dates)
temp <- t(buys_only[, 1, drop = F])
if(nchar(temp[1])==0){
temp[1] <- colnames(buys)[2]
}
buys[r, temp] <- t(buys_only[, "CountOfTrades", drop = F])
buys[r, 1] <- dates
r <- r + 1
}
}
getwd()
code_file <- paste0(getwd())
code_file <- sub("Annual Pins", "pinestimation", getwd())
sub()
code_file <- sub("Annual Pins", "pinestimation", paste0(getwd(), "ALL COMPANIES.xlsx"))
code_file <- sub("Annual Pins", "pinestimation", paste0(getwd(), "/", "ALL COMPANIES.xlsx"))
codes <- read_xlsx(code_file, sheet = "Sheet2")
View(codes)
codes <- read_xlsx(code_file, sheet = "Sheet2")[1]
View(codes)
codes <- t(codes)
final_data <- buys[, codes, drop = F]
source('C:/Users/813908/Downloads/PIN Estimation/Annual Pins/PIN Annual.R', echo=TRUE)
source('C:/Users/813908/Downloads/PIN Estimation/Annual Pins/PIN Annual.R', echo=TRUE)
warnings()
test <- codes %in% colnames(buys)
View(test)
codes16
codes[16]
codes[42]
codes[41]
codes[209]
codes[265]
codes[341]
codes[361]
codes[342]
companies <- codes[test==TRUE]
final_data <- buys[, companies, drop = F]
View(final_data)
final_data <- cbind(buys[, 1, drop = FALSE], final_data)
final_data <- final_data[1:2749, , drop = FALSE]
write.csv(final_data, file = "buys.csv", row.names = FALSE)
source('C:/Users/813908/Downloads/PIN Estimation/Annual Pins/Sell Data.R', echo=TRUE)
LBD <- unique(pin_data[, "LogicalBusinessDay", drop = T])
View(pin_data)
pin_names <- file.info(list.files
(path = getwd(),
pattern = "[0-9]{4}.csv",
full.names = T))
pin_names <- file.info(list.files
(path = getwd(),
pattern = "*.csv",
full.names = T))
pin_names <- file.info(list.files
(path = getwd(),
pattern = "[0-9]{4}.csv",
full.names = T))
pin_files <- rownames(pin_names)
pin_files
source('C:/Users/813908/Downloads/PIN Estimation/Annual Pins/Sell Data.R', echo=TRUE)
test <- codes %in% colnames(sells)
companies <- codes[test==TRUE]
final_data <- sells[, companies, drop = F]
final_data <- cbind(sells[, 1, drop = FALSE], final_data)
final_data <- final_data[1:2749, , drop = FALSE]
write.csv(final_data, file = "sells.csv", row.names = FALSE)
View(final_data)
